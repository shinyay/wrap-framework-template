# GitHub Copilot リポジトリ共通指示（.github/copilot-instructions.md）

このファイルは、GitHub Copilot に対して「このリポジトリでの作業の進め方・品質基準・禁止事項」を伝えるためのものです。
（Copilot coding agent / Copilot Chat / Copilot code review に適用されます。）


## 1. このリポジトリの目的
- このリポジトリは、ほぼ空の状態から **Issue 駆動で新規アプリケーションを育てる**ための “WRAP” 実験台です。
- 作業は原則として Issue（特に “Copilot Task (Ultra-detailed)” フォーム）を起点に進めます。
- 目標は「小さく安全に」「レビュー可能な単位で」前進することです。


## 2. もっとも重要な原則（必ず守る）
1) **Issue が仕様（Source of Truth）**  
   - Issue の説明と Acceptance Criteria を満たすことが最優先。
   - 曖昧な点があれば、勝手に広げず「前提・仮定」を PR で明示する。

2) **Atomic（原子）にする**  
   - 無関係なリファクタ・整形・ファイル移動を混ぜない（差分ノイズを増やさない）。
   - 1PR に閉じない場合は、Issue 分割（提案でも可）。

3) **常に検証可能（Build/Test 可能）に保つ**  
   - 変更後にローカル/CI で再現できるコマンド（build/test/lint 等）を整備し、README に書く。
   - 可能なら PR で「実行したコマンド」を明記する。  
   ※ Copilot が自分の環境で build/test/validate できるほど良いPRになりやすい、という考え方に沿う。:contentReference[oaicite:4]{index=4}

4) **セキュリティ最優先**  
   - 秘密情報（トークン、鍵、接続文字列、個人情報など）は絶対にコミットしない。
   - 設定が必要なら `.env.example` 等 “例” として追加し、実体は作らない。


## 3. ブートストラップ（空リポ→新規アプリ立ち上げ）時の方針
### 3.1 技術スタックの扱い
- **Issue にスタック指定がある場合**：それに従う。
- **Issue にスタック指定がない場合**：いきなりフレームワーク選定で突っ走らない。
  - まず `docs/stack-decision.md`（または Issue/PR 本文）に 2〜3 案とトレードオフを簡潔に書き、意思決定を待つ。
  - 例外：Issue が「任意でよい」「サンプルでよい」と明記している場合は、最小構成を提案しつつ実装してよい（ただし前提を明示）。

### 3.2 “標準コマンド” の提供（強く推奨）
- リポジトリ直下に **Makefile（または同等のスクリプト）** を用意し、以下のコマンドを提供するのを推奨：
  - `make setup`（依存導入/restore）
  - `make build`（ビルド）
  - `make test`（テスト）
  - `make lint`（lint）
  - `make fmt`（フォーマット）
  - `make run`（ローカル起動）
  - `make ci`（build + lint + test をまとめて実行）
- これらは README にも必ず記載する（人間も Copilot も迷わない）。

### 3.3 推奨ディレクトリ構成（スタックで強い慣習がない場合）
- `src/`：本体コード
- `tests/`：テスト
- `docs/`：設計/メモ/意思決定ログ
- `.github/`：Issue form、workflow、Copilot 指示


## 4. 品質基準
### 4.1 テスト
- 変更が “挙動” を変えるなら、原則テストを追加/更新する。
- 追加テストが難しい場合は、PR で理由と代替検証手順（手動QA）を明記する。

### 4.2 エラーハンドリング
- 「黙って失敗」しない。ログ/エラーメッセージ/戻り値で原因が追えるようにする。
- ユーザー向けメッセージと開発者向け情報（ログ等）を混同しない。

### 4.3 依存関係
- 新しい依存追加は最小限。Issue で要求されていない場合は、追加前に PR で理由を説明する。
- 重いフレームワーク/ツールの導入は、Issue に明記がない限り避ける。


## 5. PR（Pull Request）に求めること
PR の本文に以下を含める：
- 何を変えたか（3〜7行で要約）
- Issue へのリンク
- 検証方法（実行コマンド + 手動手順）
- 前提/仮定、非ゴール（スコープ外）を明記
- 破壊的変更がある場合は、その影響範囲と回避策

また、**差分ノイズを増やさない**こと（不要な整形・順序入れ替え・無関係ファイル変更はしない）。


## 6. 触ってはいけないもの（Issue で明示されない限り）
- `LICENSE`（ライセンス条文）
- `.github/ISSUE_TEMPLATE/**`（Issueフォーム類）
- 生成物（generated/、vendor/、node_modules/ など）
- 秘密情報が入り得るファイル（`.env` 実体、秘密鍵、証明書 など）

